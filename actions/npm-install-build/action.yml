name: NPM Install & Build
description: Install dependencies and build a Node.js project using npm with caching and optional registry auth.

inputs:
  node-version:
    description: Node.js version to use
    required: false
    default: '22.x'
  working-directory:
    description: Directory containing the project
    required: false
    default: '.'
  install-command:
    description: Install command to run
    required: false
    default: 'npm ci --no-audit'
  build-command:
    description: Build command to run
    required: false
    default: 'npm run build'
  registry-url:
    description: Optional npm registry URL for scoped/private packages
    required: false
    default: ''
  registry-scope:
    description: Optional npm scope (e.g., '@your-scope') for auth
    required: false
    default: ''
  npm-token:
    description: NPM auth token for private registry access
    required: false
    default: ''

runs:
  using: composite
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: npm
        cache-dependency-path: ${{ inputs.working-directory }}/package-lock.json
        registry-url: ${{ inputs.registry-url }}
        scope: ${{ inputs.registry-scope }}
        always-auth: ${{ inputs.registry-url != '' }}

    - name: Install Dependencies
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ inputs.install-command }}
      env:
        NODE_AUTH_TOKEN: ${{ inputs.npm-token }}

    - name: Build
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ inputs.build-command }}
      env:
        NODE_AUTH_TOKEN: ${{ inputs.npm-token }}
